# TODO
# * system user obviously cannot chroot, which makes building in custom envs impossible. Add a second service `iceccd-root` that can?
# * do we need anything else than the service's conf file? ... debian ships a full-blown conf file that pre-defines all cmdline args
#
# references:
# 	* https://sources.debian.org/src/icecc/1.3.1-1/debian/
# 	* https://src.fedoraproject.org/rpms/icecream/tree/master

# Template file for 'icecream'
pkgname=icecream
version=1.3.1
revision=1
build_style=gnu-configure
configure_args="--enable-shared"
hostmakedepends="automake libtool docbook2x"
makedepends="libcap-ng-devel lzo-devel libarchive-devel"
short_desc="Distributed compiler with a central scheduler to share build load"
maintainer="Piraty <piraty1@inbox.ru>"
license="GPL-2.0-or-later"
homepage="https://github.com/icecc/icecream"
distfiles="https://github.com/icecc/icecream/archive/${version}.tar.gz"
checksum=9f45510fb2251d818baebcff19051c1cf059e48c6b830fb064a8379480159b9d
patch_args="-Np1"

system_accounts="_icecc"

pre_configure() {
	autoreconf -vfi
}

post_install() {
	vsv iceccd
	vsv icecc-scheduler
}

icecream-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove "usr/lib/*.la"
	}
}
