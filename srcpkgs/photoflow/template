# Template file for 'photoflow'
pkgname=photoflow
version=0.2.8
revision=1
# bundled sources of rawspeed are outdated and FTBFS
_rawspeed_version=3.3
wrksrc=PhotoFlow-${version}
#archs="i686 x86_64"
build_style=cmake
configure_args="-DBUNDLED_LENSFUN=OFF -DBUNDLED_GEXIV2=OFF"
#make_build_args=""
#make_install_args=""
#conf_files=""
#make_dirs="/var/log/dir 0755 root root"
hostmakedepends="pkg-config gettext"
makedepends="tiff-devel libpng-devel expat-devel lcms2-devel fftw-devel
 libxml2-devel libexif-devel libsigc++-devel pixman-devel libmagick-devel
 libvips-devel gtkmm2-devel pugixml-devel exiv2-devel lensfun-devel"
short_desc="Photo retouching program"
maintainer="Piraty <piraty1@inbox.ru>"
license="GPL-3.0-or-later"
homepage="https://aferrero2707.github.io/PhotoFlow"
distfiles="
 https://github.com/aferrero2707/PhotoFlow/archive/v${version}.tar.gz
 https://github.com/darktable-org/rawspeed/archive/v${_rawspeed_version}.tar.gz"
checksum="
 196c0d84c0e1dd49bfde55a9930afbc28a30aa061f3bd1cba6d18792f601f5d2
 f8cc1c896c43bedc6a4a37e2f2f78be0e88c149887651413f5be1aa90710c389"

post_extract() {
	## don't use bundled libraries
	## * darktables: photoflow requries colorspaces.h
	## * rawspeed :currently not a stand-alone library
	#for ext in lensfun exiv2; do
	#	rm -r src/external/$ext
	#done

	# use a more recent rawspeed than the one bundled
	rm -r src/external/rawspeed
	ln -s ${XBPS_BUILDDIR}/rawspeed-${_rawspeed_version} src/external/rawspeed

	# some patching...
	vsed -i src/external/rawspeed/cmake/compiler-flags.cmake \
		-e 's/CMAKE_CXX_STANDARD 14/CMAKE_CXX_STANDARD 11/'
	vsed -i src/external/rawspeed/src/librawspeed/common/Array2DRef.h \
		-e 's/enable_if_t/enable_if/'
}
